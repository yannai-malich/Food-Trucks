FROM alpine:latest AS first
RUN apk --update add npm
WORKDIR /app/flask-app
COPY package*.json webpack.config.js /app/flask-app/
RUN npm install
RUN npm run build


FROM alpine:latest
COPY --from=first /app/flask-app /app/flask-app
RUN apk --update add python3
RUN apk --update add py-pip
WORKDIR /app/flask-app
COPY requirements.txt /app/flask-app
RUN pip install -r requirements.txt
COPY . /app/flask-app
CMD ["python3", "./app.py"]
